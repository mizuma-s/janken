<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Teachable Machine Test</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.20.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/pose@0.8.4/dist/teachablemachine-pose.min.js"></script>
</head>
<body>
  <h1>Teachable Machine Test</h1>
  <video id="webcam" autoplay playsinline></video>
  <p id="result">Waiting...</p>
  <script>
    let model, webcam;
    async function init() {
      try {
        const modelURL = "./models/pose/model.json";
        const metadataURL = "./models/pose/metadata.json";
        console.log("モデルをロード中...");
        model = await tmPose.load(modelURL, metadataURL);
        console.log("モデルのロード完了。");
        webcam = new tmPose.Webcam(500, 500, true); // サイズ: 500x500, 水平反転
        await webcam.setup();
        await webcam.play();
        document.getElementById("webcam").srcObject = webcam.webcam;
        console.log("カメラの初期化完了。");
        predict();
      } catch (error) {
        console.error("初期化エラー:", error);
      }
    }
    async function predict() {
      try {
        const { pose, posenetOutput } = await model.estimatePose(webcam.canvas);
        console.log("ポーズ推論結果:", pose);
        document.getElementById("result").innerText = "ポーズ推論完了";
      } catch (error) {
        console.error("推論エラー:", error);
      }
    }
    window.onload = init;
  </script>
</body>
</html>